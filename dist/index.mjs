#!/usr/bin/env node
var st=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),N=t=>{throw TypeError(t)};var Ot=(t,e,n)=>e.has(t)||N("Cannot "+n);var F=(t,e,n)=>(Ot(t,e,"read from private field"),n?n.call(t):e.get(t)),at=(t,e,n)=>e.has(t)?N("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n);var G=(t,e,n)=>{if(e!=null){typeof e!="object"&&typeof e!="function"&&N("Object expected");var i,s;n&&(i=e[st("asyncDispose")]),i===void 0&&(i=e[st("dispose")],n&&(s=i)),typeof i!="function"&&N("Object not disposable"),s&&(i=function(){try{s.call(this)}catch(r){return Promise.reject(r)}}),t.push([n,i,e])}else n&&t.push([n]);return e},Q=(t,e,n)=>{var i=typeof SuppressedError=="function"?SuppressedError:function(u,o,a,c){return c=Error(a),c.name="SuppressedError",c.error=u,c.suppressed=o,c},s=u=>e=n?new i(u,e,"An error was suppressed during disposal"):(n=!0,u),r=u=>{for(;u=t.pop();)try{var o=u[1]&&u[1].call(u[2]);if(u[0])return Promise.resolve(o).then(r,a=>(s(a),r()))}catch(a){s(a)}if(n)throw e};return r()};import jt from"@parcel/watcher";import{compile as It,env as Mt,Instrumentation as dt}from"@tailwindcss/node";import{clearRequireCache as Ut}from"@tailwindcss/node/require-cache";import{Scanner as Lt}from"@tailwindcss/oxide";import{Features as X,transform as qt}from"lightningcss";import{existsSync as Et}from"node:fs";import Z from"node:fs/promises";import v from"node:path";var C,k=class{constructor(){at(this,C,new Set([]))}queueMacrotask(e){let n=setTimeout(e,0);return this.add(()=>{clearTimeout(n)})}add(e){return F(this,C).add(e),()=>{F(this,C).delete(e),e()}}async dispose(){for(let e of F(this,C))await e();F(this,C).clear()}};C=new WeakMap;import zt from"node:fs";import lt from"node:path";import{stripVTControlCharacters as Dt}from"node:util";import g from"picocolors";import ut from"enhanced-resolve";import Bt from"node:fs";import{createRequire as Nt}from"node:module";var Wt=Nt(import.meta.url).resolve;function ct(t){return Wt(t)}var re=ut.ResolverFactory.createResolver({fileSystem:new ut.CachedInputFileSystem(Bt,4e3),useSyncFileSystemCalls:!0,extensions:[".css"],mainFields:["style"],conditionNames:["style"]});function pt(t){let e=typeof t=="number"?BigInt(t):t;return e<1000n?`${e}ns`:(e/=1000n,e<1000n?`${e}\xB5s`:(e/=1000n,e<1000n?`${e}ms`:(e/=1000n,e<60n?`${e}s`:(e/=60n,e<60n?`${e}m`:(e/=60n,e<24n?`${e}h`:(e/=24n,`${e}d`))))))}var W={indent:2};function z(){return`${g.italic(g.bold(g.blue("\u2248")))} tailwind-plugin-theme ${g.blue(`v${_t()}`)}`}function D(t){return`${g.dim(g.blue("`"))}${g.blue(t)}${g.dim(g.blue("`"))}`}function ft(t,e=process.cwd(),{preferAbsoluteIfShorter:n=!0}={}){let i=lt.relative(e,t);return i.startsWith("..")||(i=`.${lt.sep}${i}`),n&&i.length>t.length?t:i}function Y(t,e){let n=t.split(" "),i=[],s="",r=0;for(let u of n){let o=Dt(u).length;r+o+1>e&&(i.push(s),s="",r=0),s+=(r?" ":"")+u,r+=o+(r?1:0)}return r&&i.push(s),i}function _(t){let e=pt(t);return t<=50*1e6?g.green(e):t<=300*1e6?g.blue(e):t<=1e3*1e6?g.yellow(e):g.red(e)}function A(t,e=0){return`${" ".repeat(e+W.indent)}${t}`}function b(t=""){process.stderr.write(`${t}
`)}function m(t=""){process.stdout.write(`${t}
`)}function _t(){let{version:t}=JSON.parse(zt.readFileSync(ct("@rymcu/tailwind-plugin-theme/package.json"),"utf-8"));return t}import H from"node:fs/promises";import Pt from"node:path";function O(){return new Promise((t,e)=>{let n="";process.stdin.on("data",i=>{n+=i}),process.stdin.on("end",()=>t(n)),process.stdin.on("error",i=>e(i))})}async function mt(t,e){try{if(await H.readFile(t,"utf8")===e)return}catch{}await H.mkdir(Pt.dirname(t),{recursive:!0}),await H.writeFile(t,e,"utf8")}var ht=String.raw,p=Mt.DEBUG;function P(){return{"--input":{type:"string",description:"Input json file",alias:"-i"},"--output":{type:"string",description:"Output path",alias:"-o"},"--watch":{type:"boolean | string",description:"Watch for changes and rebuild as needed",alias:"-w"},"--minify":{type:"boolean",description:"Optimize and minify the output",alias:"-m"},"--optimize":{type:"boolean",description:"Optimize the output without minifying"},"--cwd":{type:"string",description:"The current working directory",default:"."}}}async function gt(t){try{return await t()}catch(e){e instanceof Error&&b(e.toString()),process.exit(1)}}async function wt(t){var nt=[];try{let e=G(nt,new dt);p&&e.start("[@tailwindcss-theme-plugin] (initial build)");let n=v.resolve(t["--cwd"]);t["--output"]&&(t["--output"]=v.resolve(n,t["--output"]));t["--input"]&&t["--input"]!=="-"&&(t["--input"]=v.resolve(n,t["--input"]),Et(t["--input"])||(b(`Specified input file ${D(ft(t["--input"]))} does not exist.`),process.exit(1)));let i=process.hrtime.bigint();let s=t["--input"]?t["--input"]==="-"?await O():await Z.readFile(t["--input"],"utf-8"):ht`
        @import 'tailwindcss';
      `;let r={css:"",optimizedCss:""};async function u(S,w,d){let x=S;if(w["--minify"]||w["--optimize"])if(S!==r.css){p&&d.start("Optimize CSS");let R=Kt(S,{file:w["--input"]??"input.css",minify:w["--minify"]??!1});p&&d.end("Optimize CSS"),r.css=S,r.optimizedCss=R,x=R}else x=r.optimizedCss;p&&d.start("Write output"),w["--output"]?await mt(w["--output"],x):m(x),p&&d.end("Write output")}let o=t["--input"]&&t["--input"]!=="-"?v.resolve(t["--input"]):null;let a=o?v.dirname(o):process.cwd();let c=o?[o]:[];async function f(S,w){p&&w.start("Setup compiler");let d=await It(S,{base:a,onDependency(E){c.push(E)}}),x=(d.root==="none"?[]:d.root===null?[{base:n,pattern:"**/*"}]:[d.root]).concat(d.globs),R=new Lt({sources:x});return p&&w.end("Setup compiler"),[d,R]}let[y,h]=await gt(()=>f(s,e));if(t["--watch"]){let S=await bt(yt(h),async function w(d){try{var x=[];try{if(d.length===1&&d[0]===t["--output"])return;let l=G(x,new dt);p&&l.start("[@tailwindcss-plugin-theme] (watcher)");let it=process.hrtime.bigint();let rt=[];let K="incremental";let ot=c;for(let T of d){if(ot.includes(T)){K="full";break}rt.push({file:T,extension:v.extname(T).slice(1)})}let J="";if(K==="full"){let T=t["--input"]?t["--input"]==="-"?await O():await Z.readFile(t["--input"],"utf-8"):ht`
                  @import 'tailwindcss';
                `;Ut(ot),c=o?[o]:[],[y,h]=await f(T,l),p&&l.start("Scan for candidates");let V=h.scan();p&&l.end("Scan for candidates"),p&&l.start("Setup new watchers");let At=await bt(yt(h),w);p&&l.end("Setup new watchers"),p&&l.start("Cleanup old watchers"),await S(),p&&l.end("Cleanup old watchers"),S=At,p&&l.start("Build CSS"),J=y.build(V),p&&l.end("Build CSS")}else if(K==="incremental"){p&&l.start("Scan for candidates");let T=h.scanFiles(rt);if(p&&l.end("Scan for candidates"),T.length<=0){let V=process.hrtime.bigint();b(`Done in ${_(V-it)}`);return}p&&l.start("Build CSS"),J=y.build(T),p&&l.end("Build CSS")}await u(J,t,l);let kt=process.hrtime.bigint();b(`Done in ${_(kt-it)}`)}catch(R){var E=R,Ft=!0}finally{Q(x,E,Ft)}}catch(l){l instanceof Error&&b(l.toString())}});t["--watch"]!=="always"&&process.stdin.on("end",()=>{S().then(()=>process.exit(0),()=>process.exit(1))}),process.stdin.resume()}p&&e.start("Scan for candidates");let L=h.scan();p&&e.end("Scan for candidates");p&&e.start("Build CSS");let B=await gt(()=>y.build(L));p&&e.end("Build CSS");await u(B,t,e);let q=process.hrtime.bigint();b(z());b();b(`Done in ${_(q-i)}`)}catch(Ct){var Rt=Ct,vt=!0}finally{Q(nt,Rt,vt)}}function yt(t){return t.globs.flatMap(e=>e.pattern[0]==="!"?[]:e.pattern===""?[]:e.base)}async function bt(t,e){t=t.sort((o,a)=>o.length-a.length);let n=[];for(let o=0;o<t.length;++o)for(let a=0;a<o;++a)t[o].startsWith(`${t[a]}/`)&&n.push(t[o]);t=t.filter(o=>!n.includes(o));let i=new k,s=new Set,r=new k;async function u(){await r.dispose(),r.queueMacrotask(()=>{e(Array.from(s)),s.clear()})}for(let o of t){let{unsubscribe:a}=await jt.subscribe(o,async(c,f)=>{if(c){console.error(c);return}await Promise.all(f.map(async y=>{if(y.type==="delete")return;let h=null;try{h=await Z.lstat(y.path)}catch{}!h?.isFile()&&!h?.isSymbolicLink()||s.add(y.path)})),await u()});i.add(a)}return async()=>{await i.dispose(),await r.dispose()}}function Kt(t,{file:e="input.css",minify:n=!1}={}){function i(s){return qt({filename:e,code:s,minify:n,sourceMap:!1,drafts:{customMedia:!0},nonStandard:{deepSelectorCombinator:!0},include:X.Nesting,exclude:X.LogicalProperties|X.DirSelector,targets:{safari:16<<16|1024,ios_saf:16<<16|1024,firefox:8388608,chrome:7274496},errorRecovery:!0}).code}return i(i(Buffer.from(t))).toString()}import Vt from"mri";function xt(t,e=process.argv.slice(2)){let n=Vt(e),i={_:n._};for(let[s,{type:r,alias:u,default:o=r==="boolean"?!1:null}]of Object.entries(t)){if(i[s]=o,u){let a=u.slice(1);n[a]!==void 0&&(i[s]=St(n[a],r))}{let a=s.slice(2);n[a]!==void 0&&(i[s]=St(n[a],r))}}return i}function St(t,e){switch(e){case"string":return M(t);case"boolean":return j(t);case"number":return I(t);case"boolean | string":return j(t)??M(t);case"number | string":return I(t)??M(t);case"boolean | number":return j(t)??I(t);case"boolean | number | string":return j(t)??I(t)??M(t);default:throw new Error(`Unhandled type: ${e}`)}}function j(t){if(t===!0||t===!1)return t;if(t==="true")return!0;if(t==="false")return!1}function I(t){if(typeof t=="number")return t;{let e=Number(t);if(!Number.isNaN(e))return e}}function M(t){return`${t}`}import $ from"picocolors";function tt({invalid:t,usage:e,options:n}){let i=process.stdout.columns;if(m(z()),t&&(m(),m(`${$.dim("Invalid command:")} ${t}`)),e&&e.length>0){m(),m($.dim("Usage:"));for(let[s,r]of e.entries()){let u=r.slice(0,r.indexOf("[")),o=r.slice(r.indexOf("["));o=o.replace(/\[.*?\]/g,f=>$.dim(f));let c=Y(o,i-W.indent-u.length-1);c.length>1&&s!==0&&m(),m(A(`${u}${c.shift()}`));for(let f of c)m(A(f,u.length))}}if(n){let s=0;for(let{alias:a}of Object.values(n))a&&(s=Math.max(s,a.length));let r=[],u=0;for(let[a,{alias:c}]of Object.entries(n)){let f=[c&&`${c.padStart(s)}`,c?a:" ".repeat(s+2)+a].filter(Boolean).join(", ");r.push(f),u=Math.max(u,f.length)}m(),m($.dim("Options:"));let o=8;for(let{description:a,default:c=null}of Object.values(n)){let f=r.shift(),y=o+(u-f.length),h=2,L=i-f.length-y-h-W.indent,B=Y(c!==null?`${a} ${$.dim(`[default:\u202F${D(`${c}`)}]`)}`:a,L);m(A(`${$.blue(f)} ${$.dim($.gray("\xB7")).repeat(y)} ${B.shift()}`));for(let q of B)m(A(`${" ".repeat(f.length+y+h)}${q}`))}}}import Gt from"node:fs";var Qt=String.raw;async function Yt(t){let e=Qt`{}`;t&&(t==="-"?e=await O():e=await Gt.promises.readFile(t,"utf-8"));let n=JSON.parse(e);return n.themes||(b("Invalid theme file. Please check if the file is a valid JSON file."),process.exit(1)),n.themes}async function Tt(t){let e=await Yt(t["--input"]),n=Ht(e,t);await Promise.all(n.map(async i=>{b(`building ${i["--input"]} file...`),await wt(i)}))}function Ht(t,e){return t.map(n=>({...e,"--input":n.input,"--output":`${e["--output"]}/${n.name}.css`}))}var et={"--help":{type:"boolean",description:"Display usage information",alias:"-h"}},U=xt({...P(),...et}),$t=U._[0];$t&&(tt({invalid:$t,usage:["tailwind-plugin-theme [options]"],options:{...P(),...et}}),process.exit(1));(process.stdout.isTTY&&!U["--output"]||U["--help"])&&(tt({usage:["tailwind-plugin-theme [--input input.css] [--output output.css] [--watch] [options\u2026]"],options:{...P(),...et}}),process.exit(0));Tt(U);
//# sourceMappingURL=index.mjs.map